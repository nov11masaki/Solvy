<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>問題登録 - Solvy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="logo">📐 Solvy - 問題登録</h1>
            <p class="tagline">AIが自動で解答ステップを生成します</p>
            <a href="/" class="back-link">← ホームに戻る</a>
        </header>

        <main class="admin-content">
            <section class="problem-form-section">
                <h2>📝 新しい問題を登録</h2>
                
                <form id="problemForm">
                    <div class="form-group">
                        <label for="problemTitle">問題タイトル <span class="required">*</span></label>
                        <input type="text" id="problemTitle" required placeholder="例: 星型五角形の内角の和">
                    </div>

                    <div class="form-group">
                        <label for="problemDescription">問題文 <span class="required">*</span></label>
                        <textarea id="problemDescription" rows="4" required placeholder="詳細な問題文を入力してください"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="problemLevel">難易度 <span class="required">*</span></label>
                        <select id="problemLevel" required>
                            <option value="">選択してください</option>
                            <option value="middle-school">中学レベル</option>
                            <option value="high-school">高校レベル</option>
                            <option value="university">大学レベル</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="problemCategory">カテゴリ</label>
                        <input type="text" id="problemCategory" placeholder="例: 図形、代数、確率">
                    </div>

                    <div class="form-group">
                        <label for="problemKeywords">キーワード（カンマ区切り）</label>
                        <input type="text" id="problemKeywords" placeholder="例: 五角形, 内角, 図形">
                    </div>

                    <div class="form-group">
                        <label for="problemTheorems">使用する定理（カンマ区切り）</label>
                        <input type="text" id="problemTheorems" placeholder="例: 三角形の内角の和, 多角形の外角の和">
                    </div>

                    <div class="ai-section">
                        <h3>🤖 AI解答生成オプション</h3>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="useAI" checked>
                                AIに解答ステップを自動生成させる
                            </label>
                        </div>
                        <p class="help-text">
                            チェックを入れると、OpenAI GPT-4が問題を解析し、
                            段階的な解答ステップ、ヒント、解説を自動生成します。
                        </p>
                    </div>

                    <button type="submit" class="btn-primary" id="submitBtn">
                        🚀 問題を登録してAIに解かせる
                    </button>
                </form>
            </section>

            <section class="preview-section" id="previewSection" style="display: none;">
                <h2>👁️ AI生成結果プレビュー</h2>
                
                <div class="ai-thinking" id="aiThinking">
                    <div class="thinking-animation">
                        <div class="thinking-dot"></div>
                        <div class="thinking-dot"></div>
                        <div class="thinking-dot"></div>
                    </div>
                    <p>AIが問題を解析中...</p>
                    <div class="thinking-details" id="thinkingDetails">
                        <p>🧠 問題の意図を分析しています</p>
                    </div>
                </div>

                <div class="preview-content" id="previewContent" style="display: none;">
                    <div class="preview-header">
                        <h3 id="previewTitle"></h3>
                        <span class="preview-level" id="previewLevel"></span>
                    </div>
                    
                    <div class="preview-description">
                        <strong>問題文:</strong>
                        <p id="previewDescription"></p>
                    </div>

                    <div class="ai-analysis">
                        <h4>🤖 AIの分析</h4>
                        <div class="analysis-item">
                            <strong>解答の意図:</strong>
                            <p id="aiIntent"></p>
                        </div>
                        <div class="analysis-item">
                            <strong>推奨される解法:</strong>
                            <p id="aiApproach"></p>
                        </div>
                        <div class="analysis-item">
                            <strong>難易度評価:</strong>
                            <p id="aiDifficulty"></p>
                        </div>
                    </div>

                    <div class="preview-steps">
                        <h4>📚 生成された解答ステップ</h4>
                        <div id="stepsList"></div>
                    </div>

                    <div class="preview-actions">
                        <button class="btn-primary" id="confirmBtn">✅ この内容で登録する</button>
                        <button class="btn-secondary" id="editBtn">✏️ 編集する</button>
                    </div>
                </div>
            </section>

            <section class="problems-list-section">
                <h2>📚 登録済みの問題一覧</h2>
                <div id="problemsList" class="problems-grid"></div>
            </section>
        </main>

        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-spinner"></div>
            <p>処理中...</p>
        </div>

        <div class="error-alert" id="errorAlert" style="display: none;">
            <span id="errorMessage"></span>
            <button class="close-btn" id="closeErrorBtn">×</button>
        </div>

        <div class="success-alert" id="successAlert" style="display: none;">
            <span id="successMessage"></span>
            <button class="close-btn" id="closeSuccessBtn">×</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
